<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTDownloader - Download TikTok Tanpa Watermark</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #000000;
            --secondary: #00f2ea;
            --accent: #ff0050;
            --dark: #121212;
            --light: #ffffff;
            --gray: #2d2d2d;
        }
        
        body {
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            background: linear-gradient(135deg, #000000 0%, #2d2d2d 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid var(--gray);
            margin-bottom: 40px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            font-size: 40px;
            color: var(--accent);
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(45deg, var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        
        .tagline {
            color: #aaa;
            font-size: 1.2rem;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 50px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Card Styles */
        .card {
            background: rgba(40, 40, 40, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--gray);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 0, 80, 0.1);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            color: var(--light);
            font-size: 1.5rem;
        }
        
        .card-title i {
            color: var(--secondary);
        }
        
        /* Input Area */
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            color: #ccc;
            font-weight: 500;
        }
        
        .url-input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--gray);
            border-radius: 12px;
            color: var(--light);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .url-input:focus {
            outline: none;
            border-color: var(--secondary);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .url-input::placeholder {
            color: #666;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(45deg, var(--accent), #ff3366);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 0, 80, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: var(--gray);
            margin-top: 15px;
        }
        
        .btn-secondary:hover {
            background: #3d3d3d;
        }
        
        /* Preview Section */
        .preview-section {
            margin-top: 30px;
            display: none;
        }
        
        .preview-title {
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .video-preview {
            width: 100%;
            border-radius: 12px;
            background: #000;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .video-preview video {
            max-width: 100%;
            max-height: 300px;
        }
        
        .video-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--gray);
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        /* Download Options */
        .download-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .download-btn {
            background: var(--gray);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .download-btn:hover {
            background: var(--accent);
            border-color: var(--secondary);
        }
        
        .quality {
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        
        .size {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Features */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--gray);
        }
        
        .feature-icon {
            font-size: 30px;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error */
        .error {
            background: rgba(255, 0, 80, 0.1);
            border-left: 4px solid var(--accent);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 30px 0;
            border-top: 1px solid var(--gray);
            margin-top: 50px;
            color: #777;
        }
        
        .disclaimer {
            background: rgba(255, 0, 80, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #aaa;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-video logo-icon"></i>
                <h1>TTDownloader</h1>
            </div>
            <p class="tagline">Download Video TikTok Tanpa Watermark - Gratis & Cepat</p>
        </header>
        
        <div class="main-content">
            <!-- Downloader Card -->
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-download"></i> Download Video
                </h2>
                
                <div class="input-group">
                    <label class="input-label">
                        <i class="fas fa-link"></i> Masukkan Link TikTok
                    </label>
                    <input type="url" 
                           id="tiktokUrl" 
                           class="url-input" 
                           placeholder="https://www.tiktok.com/@username/video/1234567890"
                           autocomplete="off">
                </div>
                
                <button id="fetchBtn" class="btn">
                    <i class="fas fa-search"></i> Analisis Video
                </button>
                
                <button id="pasteBtn" class="btn btn-secondary">
                    <i class="fas fa-paste"></i> Tempel dari Clipboard
                </button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Menganalisis link TikTok...</p>
                    <p>Harap tunggu sebentar</p>
                </div>
                
                <div class="error" id="error">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="errorMessage"></span>
                </div>
                
                <div class="preview-section" id="previewSection">
                    <h3 class="preview-title">
                        <i class="fas fa-eye"></i> Preview Video
                    </h3>
                    
                    <div class="video-preview" id="videoPreview">
                        <!-- Video preview will be inserted here -->
                    </div>
                    
                    <div class="video-info" id="videoInfo">
                        <!-- Video info will be inserted here -->
                    </div>
                    
                    <h3 class="preview-title" style="margin-top: 30px;">
                        <i class="fas fa-download"></i> Pilihan Download
                    </h3>
                    
                    <div class="download-options" id="downloadOptions">
                        <!-- Download buttons will be inserted here -->
                    </div>
                </div>
            </div>
            
            <!-- Features Card -->
            <div class="card">
                <h2 class="card-title">
                    <i class="fas fa-star"></i> Fitur Unggulan
                </h2>
                
                <div class="features-grid">
                    <div class="feature-item">
                        <i class="fas fa-water feature-icon"></i>
                        <h3>Tanpa Watermark</h3>
                        <p>Download video bersih tanpa logo TikTok</p>
                    </div>
                    
                    <div class="feature-item">
                        <i class="fas fa-bolt feature-icon"></i>
                        <h3>Cepat & Gratis</h3>
                        <p>Download tanpa batas dan gratis</p>
                    </div>
                    
                    <div class="feature-item">
                        <i class="fas fa-mobile-alt feature-icon"></i>
                        <h3>HD Quality</h3>
                        <p>Kualitas HD 720p & 1080p</p>
                    </div>
                    
                    <div class="feature-item">
                        <i class="fas fa-music feature-icon"></i>
                        <h3>Audio Original</h3>
                        <p>Audio tetap terjaga kualitasnya</p>
                    </div>
                </div>
                
                <h2 class="card-title" style="margin-top: 30px;">
                    <i class="fas fa-question-circle"></i> Cara Penggunaan
                </h2>
                
                <div class="features-grid">
                    <div class="feature-item">
                        <div class="step-number">1</div>
                        <p>Salin link video TikTok</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="step-number">2</div>
                        <p>Tempel link di kolom atas</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="step-number">3</div>
                        <p>Klik tombol "Analisis Video"</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="step-number">4</div>
                        <p>Pilih kualitas & download</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Disclaimer -->
        <div class="disclaimer">
            <h3><i class="fas fa-exclamation-triangle"></i> Disclaimer Penting</h3>
            <p>Website ini hanya untuk tujuan edukasi dan penggunaan pribadi. Harap hormati hak cipta dan privasi kreator konten. Jangan gunakan untuk mendownload konten tanpa izin pemilik hak cipta. Kami tidak menyimpan video yang didownload.</p>
        </div>
        
        <footer>
            <p>Â© 2024 TTDownloader - TikTok Video Downloader</p>
            <p>Dibuat dengan <i class="fas fa-heart" style="color: var(--accent);"></i> untuk komunitas</p>
            <p style="margin-top: 20px; font-size: 0.9rem;">
                <a href="#" style="color: var(--secondary); text-decoration: none; margin: 0 10px;">
                    <i class="fas fa-shield-alt"></i> Privacy Policy
                </a>
                <a href="#" style="color: var(--secondary); text-decoration: none; margin: 0 10px;">
                    <i class="fas fa-file-alt"></i> Terms of Service
                </a>
                <a href="#" style="color: var(--secondary); text-decoration: none; margin: 0 10px;">
                    <i class="fas fa-envelope"></i> Contact
                </a>
            </p>
        </footer>
    </div>

    <!-- Toastr Notifications -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    
    <script>
        // Konfigurasi Toastr
        toastr.options = {
            "positionClass": "toast-top-right",
            "progressBar": true,
            "timeOut": "3000"
        };

        // DOM Elements
        const tiktokUrlInput = document.getElementById('tiktokUrl');
        const fetchBtn = document.getElementById('fetchBtn');
        const pasteBtn = document.getElementById('pasteBtn');
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const errorMessage = document.getElementById('errorMessage');
        const previewSection = document.getElementById('previewSection');
        const videoPreview = document.getElementById('videoPreview');
        const videoInfo = document.getElementById('videoInfo');
        const downloadOptions = document.getElementById('downloadOptions');
        
        // Validasi URL TikTok
        function isValidTikTokUrl(url) {
            const patterns = [
                /tiktok\.com\/@[\w.-]+\/video\/\d+/,
                /vm\.tiktok\.com\/[\w]+/,
                /vt\.tiktok\.com\/[\w]+/,
                /www\.tiktok\.com\/t\/[\w]+/,
                /tiktok\.com\/t\/[\w]+/
            ];
            return patterns.some(pattern => pattern.test(url));
        }
        
        // Extract Video ID from URL
        function extractVideoId(url) {
            try {
                const urlObj = new URL(url);
                const pathParts = urlObj.pathname.split('/');
                const videoIndex = pathParts.indexOf('video');
                if (videoIndex !== -1) {
                    return pathParts[videoIndex + 1];
                }
                return pathParts[pathParts.length - 1];
            } catch {
                const match = url.match(/video\/(\d+)/);
                return match ? match[1] : null;
            }
        }
        
        // API Proxy untuk menghindari CORS
        const API_PROXY = 'https://corsproxy.io/?';
        const TIKTOK_API = 'https://api.tiklydown.eu.org/api/download';
        
        // Fetch video data
        async function fetchVideoData(url) {
            const videoId = extractVideoId(url);
            if (!videoId) {
                throw new Error('Tidak dapat menemukan ID video dari link tersebut');
            }
            
            const requestUrl = `${TIKTOK_API}?url=${encodeURIComponent(url)}`;
            
            try {
                const response = await fetch(requestUrl);
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                return data;
            } catch (error) {
                // Fallback ke API alternatif
                return fetchAlternativeAPI(url);
            }
        }
        
        // Alternative API
        async function fetchAlternativeAPI(url) {
            const apis = [
                `https://api.tiklydown.eu.org/api/download?url=${encodeURIComponent(url)}`,
                `https://www.tikwm.com/api/?url=${encodeURIComponent(url)}`,
                `https://tikdown.org/api?url=${encodeURIComponent(url)}`
            ];
            
            for (const apiUrl of apis) {
                try {
                    const response = await fetch(API_PROXY + encodeURIComponent(apiUrl));
                    if (response.ok) {
                        const data = await response.json();
                        if (data.video || data.data) {
                            return data;
                        }
                    }
                } catch (error) {
                    console.log(`API ${apiUrl} failed, trying next...`);
                }
            }
            
            throw new Error('Semua API sedang tidak tersedia. Coba lagi nanti.');
        }
        
        // Display video preview
        function displayVideoPreview(videoData) {
            const video = videoData.video || videoData.data?.play || videoData.play;
            const cover = videoData.cover || videoData.data?.cover || videoData.cover;
            const author = videoData.author || videoData.data?.author || {};
            const music = videoData.music || videoData.data?.music || videoData.music;
            
            // Video preview
            videoPreview.innerHTML = `
                <video controls poster="${cover}" style="width: 100%; border-radius: 10px;">
                    <source src="${video}" type="video/mp4">
                    Browser Anda tidak mendukung tag video.
                </video>
            `;
            
            // Video info
            videoInfo.innerHTML = `
                <div class="info-row">
                    <span>Uploader:</span>
                    <span>${author.nickname || 'Unknown'}</span>
                </div>
                <div class="info-row">
                    <span>Username:</span>
                    <span>@${author.unique_id || 'unknown'}</span>
                </div>
                <div class="info-row">
                    <span>Judul:</span>
                    <span>${videoData.title || videoData.data?.title || 'No title'}</span>
                </div>
                <div class="info-row">
                    <span>Musik:</span>
                    <span>${music?.title || music?.author || 'Original Sound'}</span>
                </div>
                <div class="info-row">
                    <span>Durasi:</span>
                    <span>${videoData.duration || '00:00'}</span>
                </div>
            `;
            
            // Download options
            downloadOptions.innerHTML = `
                <div class="download-btn" onclick="downloadVideo('${video}', 'HD')">
                    <div class="quality">HD Quality</div>
                    <div class="size">No Watermark</div>
                    <i class="fas fa-download"></i>
                </div>
                <div class="download-btn" onclick="downloadVideo('${video}', 'SD')">
                    <div class="quality">SD Quality</div>
                    <div class="size">No Watermark</div>
                    <i class="fas fa-download"></i>
                </div>
                <div class="download-btn" onclick="downloadAudio('${music?.play || ''}')">
                    <div class="quality">Audio Only</div>
                    <div class="size">MP3 Format</div>
                    <i class="fas fa-music"></i>
                </div>
                <div class="download-btn" onclick="downloadCover('${cover}')">
                    <div class="quality">Thumbnail</div>
                    <div class="size">Cover Image</div>
                    <i class="fas fa-image"></i>
                </div>
            `;
            
            previewSection.style.display = 'block';
            toastr.success('Video berhasil ditemukan!');
        }
        
        // Download functions
        function downloadVideo(url, quality) {
            if (!url) {
                toastr.error('Link download tidak tersedia');
                return;
            }
            
            const proxyUrl = API_PROXY + encodeURIComponent(url);
            const fileName = `tiktok_${quality}_${Date.now()}.mp4`;
            
            toastr.info(`Memulai download ${quality}...`);
            
            const link = document.createElement('a');
            link.href = proxyUrl;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            toastr.success(`Download ${quality} dimulai!`);
        }
        
        function downloadAudio(url) {
            if (!url) {
                toastr.error('Audio tidak tersedia');
                return;
            }
            
            const proxyUrl = API_PROXY + encodeURIComponent(url);
            const fileName = `tiktok_audio_${Date.now()}.mp3`;
            
            toastr.info('Memulai download audio...');
            
            const link = document.createElement('a');
            link.href = proxyUrl;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            toastr.success('Download audio dimulai!');
        }
        
        function downloadCover(url) {
            if (!url) {
                toastr.error('Cover tidak tersedia');
                return;
            }
            
            const proxyUrl = API_PROXY + encodeURIComponent(url);
            const fileName = `tiktok_cover_${Date.now()}.jpg`;
            
            toastr.info('Memulai download thumbnail...');
            
            const link = document.createElement('a');
            link.href = proxyUrl;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            toastr.success('Download thumbnail dimulai!');
        }
        
        // Event Listeners
        fetchBtn.addEventListener('click', async () => {
            const url = tiktokUrlInput.value.trim();
            
            if (!url) {
                toastr.warning('Masukkan link TikTok terlebih dahulu');
                tiktokUrlInput.focus();
                return;
            }
            
            if (!isValidTikTokUrl(url)) {
                toastr.error('Link TikTok tidak valid!');
                errorMessage.textContent = 'Format link TikTok tidak dikenali. Pastikan link berasal dari TikTok.';
                errorDiv.style.display = 'block';
                return;
            }
            
            // Reset state
            errorDiv.style.display = 'none';
            previewSection.style.display = 'none';
            loadingDiv.style.display = 'block';
            fetchBtn.disabled = true;
            
            try {
                toastr.info('Mengambil data video...');
                const videoData = await fetchVideoData(url);
                displayVideoPreview(videoData);
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = error.message || 'Terjadi kesalahan saat mengambil video';
                errorDiv.style.display = 'block';
                toastr.error('Gagal mengambil data video');
            } finally {
                loadingDiv.style.display = 'none';
                fetchBtn.disabled = false;
            }
        });
        
        // Paste from clipboard
        pasteBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    tiktokUrlInput.value = text;
                    toastr.success('Link berhasil ditempel!');
                    
                    // Auto-fetch jika valid
                    if (isValidTikTokUrl(text)) {
                        setTimeout(() => fetchBtn.click(), 500);
                    }
                }
            } catch (error) {
                toastr.error('Gagal menempel dari clipboard');
            }
        });
        
        // Auto-paste on focus
        tiktokUrlInput.addEventListener('focus', async () => {
            try {
                const text = await navigator.clipboard.readText();
                if (text && isValidTikTokUrl(text)) {
                    tiktokUrlInput.value = text;
                }
            } catch (error) {
                // Ignore clipboard errors
            }
        });
        
        // Enter key to fetch
        tiktokUrlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                fetchBtn.click();
            }
        });
        
        // Contoh link untuk testing
        window.addEventListener('load', () => {
            // Add example URLs for testing
            const examples = [
                'https://www.tiktok.com/@example/video/1234567890',
                'https://vm.tiktok.com/ZMJwCgYfN/',
                'https://vt.tiktok.com/ZSJwCgYfN/'
            ];
            
            // Uncomment untuk testing
            // tiktokUrlInput.value = examples[0];
            
            toastr.info('Masukkan link TikTok di atas untuk memulai!');
        });
        
        // Service Worker untuk PWA (opsional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(() => console.log('Service Worker Registered'))
                    .catch(err => console.log('Service Worker Error:', err));
            });
        }
    </script>
</body>
</html>